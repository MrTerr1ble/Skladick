{% extends "base.html" %}

{% block title %}Заявка {{ purchase_request.number }}{% endblock %}

{% block topbar %}
<div class="topbar">
  <div class="tabs">
    <div class="tab active">ЗАЯВКА № {{ purchase_request.number }}</div>
  </div>
  <div class="profile">
    <a class="btn ghost" href="{% url 'procurement:purchase_request_list' %}">Назад</a>
    <a class="btn" href="{% url 'procurement:purchase_request_update' purchase_request.pk %}">Редактировать</a>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
  <div class="card">
    <div class="field">
      <span class="label">Статус</span>
      <div class="value">{{ purchase_request.get_state_display }}</div>
    </div>
    <div class="field">
      <span class="label">Номенклатура</span>
      <div class="value">{{ purchase_request.item }}</div>
    </div>
    <div class="field">
      <span class="label">Количество</span>
      <div class="value">{{ purchase_request.qty }} {{ purchase_request.uom.code }}</div>
    </div>
    <div class="field">
      <span class="label">Склад</span>
      <div class="value">{{ purchase_request.warehouse }}</div>
    </div>
    <div class="field">
      <span class="label">Поставщик</span>
      <div class="value">{{ purchase_request.supplier|default:"—" }}</div>
    </div>
    <div class="field">
      <span class="label">Комментарий</span>
      <div class="value">{{ purchase_request.comment|default:"—" }}</div>
    </div>
    <div class="field">
      <span class="label">Файл</span>
      <div class="value">
        {% if purchase_request.attachment %}
          <a href="{{ purchase_request.attachment.url }}" target="_blank">Скачать</a>
        {% else %} — {% endif %}
      </div>
    </div>
  </div>

  <div class="toolbar spaced">
    {% if purchase_request.state == 'DRAFT' %}
      <form method="post" action="{% url 'procurement:purchase_request_status_change' purchase_request.pk 'submit' %}">
        {% csrf_token %}
        <button class="btn primary" type="submit">Отправить на утверждение</button>
      </form>
    {% elif purchase_request.state == 'SUBMITTED' %}
      <form method="post" action="{% url 'procurement:purchase_request_status_change' purchase_request.pk 'approve' %}" class="inline-form">
        {% csrf_token %}
        <button class="btn primary" type="submit">Утвердить</button>
      </form>
      <form method="post" action="{% url 'procurement:purchase_request_status_change' purchase_request.pk 'reject' %}" class="inline-form">
        {% csrf_token %}
        <button class="btn danger" type="submit">Отклонить</button>
      </form>
    {% elif purchase_request.state == 'APPROVED' %}
      <div class="text-success">✅ Заявка утверждена</div>
    {% elif purchase_request.state == 'REJECTED' %}
      <div class="text-danger">❌ Заявка отклонена</div>
    {% endif %}
  </div>
</div>
{% endblock %}
